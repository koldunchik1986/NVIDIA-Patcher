# Руководство пользователя Linux NVIDIA Patcher

## Содержание

1. [Введение](#введение)
2. [Установка](#установка)
3. [Основное использование](#основное-использование)
4. [Продвинутые функции](#продвинутые-функции)
5. [Устранение проблем](#устранение-проблем)
6. [Безопасность](#безопасность)
7. [FAQ](#faq)

## Введение

Linux NVIDIA Patcher - это утилита для модификации драйверов NVIDIA с целью обхода ограничений, накладываемых производителем. Основные возможности:

- Обход проверки цифровой подписи драйверов
- Поддержка различных видеокарт в SLI режиме  
- Автоматическое создание резервных копий
- Полный откат изменений

**Важно**: Использование данного ПО может нарушать лицензионное соглашение NVIDIA. Используйте на свой страх и риск.

## Установка

### Автоматическая установка

```bash
# Скачайте проект
git clone <repository-url>
cd linux-nvidia-patcher

# Запустите инсталлятор
sudo ./install.sh
```

### Ручная установка

```bash
# Создайте директорию установки
sudo mkdir -p /opt/linux-nvidia-patcher
sudo cp -r * /opt/linux-nvidia-patcher/

# Сделайте скрипты исполняемыми
sudo chmod +x /opt/linux-nvidia-patcher/src/*.py
sudo chmod +x /opt/linux-nvidia-patcher/tools/*.sh

# Создайте символическую ссылку
sudo ln -s /opt/linux-nvidia-patcher/src/patcher.py /usr/local/bin/nvidia-patcher
```

### Требования

- Linux x86_64
- Python 3.6+
- Права суперпользователя
- Установленный драйвер NVIDIA
- Базовые утилиты: `patch`, `grep`, `awk`, `find`

## Основное использование

### Шаг 1: Проверка наличия драйверов

```bash
sudo nvidia-patcher --detect
```

Пример вывода:
```
[2024-01-01 12:00:00] Поиск установленных драйверов NVIDIA...
[2024-01-01 12:00:01] Драйвер найден через nvidia-smi: 535.274.02
Найденные поддерживаемые драйверы:
  - 535.274.02: /usr/lib/x86_64-linux-gnu/nvidia-535.274.02/
```

### Шаг 2: Применение патча

```bash
sudo nvidia-patcher --patch
```

Процесс включает:
1. Создание резервной копии
2. Применение бинарных патчей
3. Проверку целостности
4. Перезагрузку модулей

### Шаг 3: Проверка результата

```bash
python3 /opt/linux-nvidia-patcher/tools/verify_patch.py
```

### Шаг 4: Перезагрузка системы (рекомендуется)

```bash
sudo reboot
```

## Продвинутые функции

### Работа с внешними файлами драйверов

Если у вас есть .run файл драйвера:

```bash
# Извлечение драйвера
sudo /opt/linux-nvidia-patcher/tools/extract_driver.sh NVIDIA-Linux-x86_64-535.274.02.run

# Патчинг извлеченного драйвера
sudo nvidia-patcher --driver-path /tmp/nvidia-driver-extract/
```

### Автоматический режим

```bash
# Полностью автоматический патчинг с перезагрузкой модулей
sudo nvidia-patcher --auto
```

### Тестовый режим

```bash
# Проверка без применения изменений
sudo nvidia-patcher --dry-run
```

### Откат изменений

```bash
sudo nvidia-patcher --rollback
```

### Управление резервными копиями

```bash
# Просмотр доступных бэкапов
python3 -c "
from src.backup_manager import BackupManager
bm = BackupManager()
for backup in bm.list_backups():
    print(f'{backup[&quot;name&quot;]} - {backup[&quot;version&quot;]} - {backup[&quot;timestamp&quot;]}')
"

# Удаление старых бэкапов
python3 -c "
from src.backup_manager import BackupManager
bm = BackupManager()
bm.cleanup_old_backups(keep_count=3)
"
```

## Устранение проблем

### Проблема: Драйверы не найдены

**Симптомы:**
```
[WARNING] Драйверы NVIDIA не найдены
```

**Решения:**
1. Проверьте установку драйвера:
```bash
nvidia-smi
```

2. Проверьте загруженные модули:
```bash
lsmod | grep nvidia
```

3. Установите драйвер из официальных репозиториев или с сайта NVIDIA

### Проблема: Ошибка прав доступа

**Симптомы:**
```
ERROR: Permission denied
```

**Решения:**
1. Используйте sudo:
```bash
sudo nvidia-patcher --patch
```

2. Проверьте права на директории:
```bash
sudo chown -R root:root /opt/linux-nvidia-patcher/
sudo chmod 755 /opt/linux-nvidia-patcher/src/patcher.py
```

### Проблема: Ошибка применения патча

**Симптомы:**
```
ERROR: Ошибка применения патча к nvidia.ko
```

**Решения:**
1. Проверьте версию драйвера:
```bash
nvidia-smi | grep "Driver Version"
```

2. Используйте правильную версию патча или драйвера

3. Проверьте целостность файлов:
```bash
python3 /opt/linux-nvidia-patcher/tools/verify_patch.py --module /путь/к/nvidia.ko
```

### Проблема: Система не загружается после патчинга

**Решения:**
1. Загрузитесь в recovery mode
2. Откатите изменения:
```bash
sudo nvidia-patcher --rollback
```
3. Перезагрузитесь

4. Если откат не работает, восстановите из бэкапа:
```bash
# Найти бэкап
ls /var/lib/linux-nvidia-patcher/backups/

# Восстановить вручную
sudo cp /var/lib/linux-nvidia-patcher/backups/backup_name/nvidia.ko /путь/к/оригиналу/
```

## Безопасность

### Резервное копирование

Патчер автоматически создает резервные копии перед модификацией:

- Модули ядра сохраняются в `/var/lib/linux-nvidia-patcher/backups/`
- Конфигурационные файлы также резервируются
- Сохраняются контрольные суммы для проверки целостности

### Проверка целостности

Перед и после патчинга выполняются проверки:

- SHA256 контрольные суммы
- ELF сигнатуры
- Размеры файлов
- Права доступа

### Журналирование

Все операции записываются в лог:
```bash
tail -f /var/log/nvidia-patcher.log
```

### Рекомендации

1. **Всегда делайте полный бэкап системы** перед использованием
2. **Тестируйте в виртуальной машине** сначала
3. **Используйте тестовый режим** для проверки совместимости
4. **Храните важные данные** на внешних носителях

## FAQ

### Q: Законно ли использование этого патчера?

A: Использование может нарушать лицензионное соглашение NVIDIA. Используйте на свой страх и риск только в образовательных целях.

### Q: Повредит ли это моему железу?

A: Нет, патчер работает только с программным обеспечением. Однако некорректная работа может привести к нестабильности системы.

### Q: Поддерживаются ли другие версии драйверов?

A: В настоящее время официально поддерживается только 535.274.02. Другие версии могут работать с ограничениями.

### Q: Нужно ли повторять патчинг после обновления системы?

A: Да, после обновления драйвера или ядра может потребоваться повторное применение патча.

### Q: Можно ли использовать с несколькими GPU?

A: Да, патчер поддерживает конфигурации с несколькими видеокартами, включая SLI.

### Q: Что делать при сбое системы?

A: Загрузитесь в recovery mode и используйте `sudo nvidia-patcher --rollback` для отката изменений.

## Техническая поддержка

При возникновении проблем:

1. Проверьте логи: `/var/log/nvidia-patcher.log`
2. Соберите системную информацию:
```bash
uname -a > system_info.txt
nvidia-smi >> system_info.txt
lsmod | grep nvidia >> system_info.txt
```

3. Создайте подробный отчет о проблеме

## Дополнительные ресурсы

- [Основная документация](../README.md)
- [Техническая документация](TECHNICAL.md)
- [Исходный код](../src/)
- [Тесты](../tests/)